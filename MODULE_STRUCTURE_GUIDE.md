# Module Structure Guide

## Overview

RaOS has **TWO distinct Modules directories**, each serving a different purpose. This guide clarifies where modules are located and how they work.

---

## 1. Built-In Modules: `/RaCore/Modules/`

**Purpose**: Contains all built-in RaCore modules that ship with the system.

**Location**: `/RaCore/Modules/`

**Contents**:
- **Core** modules (5): Autonomy, Collaboration, LanguageModelProcessor, SelfHealing, Transparency
- **Extensions** modules (29): AIContent, Authentication, Blog, Chat, CodeGeneration, Distribution, Execution, FeatureExplorer, Forum, GameClient, GameEngine, GameServer, Knowledge, Language, License, MarketMonitor, ModuleSpawner, Planning, RaCoin, Safety, Sentiment, ServerSetup, SiteBuilder, Skills, SuperMarket, Support, TestRunner, Updates, UserProfiles
- **Handlers** modules
- **Speech** modules
- **Conscious** modules
- **Subconscious** modules

**File Types**: `.cs` source files compiled into the RaCore assembly

**When Loaded**: These modules are compiled into the RaCore project and loaded when RaCore starts.

**Version Control**: ✅ All files are tracked in git

**Example Path**:
```
/RaCore/Modules/Extensions/ModuleSpawner/ModuleSpawnerModule.cs
/RaCore/Modules/Core/SelfHealing/SelfHealingModule.cs
```

---

## 2. Dynamically Spawned Modules: `/Modules/`

**Purpose**: Container for modules dynamically generated by the Module Spawner (Phase 7).

**Location**: `/Modules/` (repository root)

**Contents**: 
- Currently only `README.md`
- Will contain subdirectories for each spawned module when created

**File Types**: 
- `.cs` source files (ignored by git)
- `.md` documentation (ignored by git)
- `.json` configuration (ignored by git)
- `.csproj` project files (NOW TRACKED after this PR ✅)
- `.sln` solution files (NOW TRACKED after this PR ✅)

**When Loaded**: After spawning, review, and approval:
1. Module generated to `/Modules/<ModuleName>/`
2. SuperAdmin reviews and approves
3. Module compiled to DLL (if .csproj exists)
4. Module loaded on next RaCore restart

**Version Control**: 
- ❌ `.cs`, `.md`, `.json` files are ignored (dynamic content)
- ✅ `.csproj` and `.sln` files are now tracked (after this PR)
- ✅ `README.md` is tracked

**Example Path**:
```
/Modules/WeatherModule/WeatherModule.cs        (ignored)
/Modules/WeatherModule/WeatherModule.csproj    (tracked ✅)
/Modules/WeatherModule/README.md               (tracked ✅)
```

---

## What Changed in the v7.5 Revamp?

The v7.5 revamp **DID NOT MOVE** any modules. Instead, it enhanced how ModuleManager discovers and loads modules:

### Before v7.5:
- ModuleManager only looked in specific predefined locations
- Limited environment awareness

### After v7.5:
- ModuleManager automatically scans entire root directory
- Discovers modules from both `/RaCore/Modules/` and `/Modules/`
- Enhanced environment discovery (Nginx, PHP, Apache, etc.)
- Improved folder monitoring capabilities
- Better search path management

**Key Point**: All built-in modules remain in `/RaCore/Modules/` where they've always been. No modules were moved or lost.

---

## Module Discovery Process

When RaCore starts, ModuleManager:

1. **Scans Search Paths**:
   - `AppContext.BaseDirectory`
   - Current directory
   - `/Modules/` (root)
   - `/RaCore/Modules/` (via recursive scanning)

2. **Loads DLL Files**:
   - Any `.dll` file in a `Modules/` folder (at any depth)
   - Checks for classes with `[RaModule]` attribute
   - Instantiates and initializes modules

3. **Loads Built-In Modules**:
   - Scans RaCore assembly for types in `RaCore.Modules.*` namespace
   - Loads Core and Extension modules automatically

---

## What This PR Changed

### Before This PR:
```gitignore
# Dynamically spawned modules (Phase 7 - Module Spawner)
# Keep the README but ignore generated modules
Modules/*
!Modules/README.md
```

**Result**: Everything in `/Modules/` was ignored except `README.md`

### After This PR:
```gitignore
# Dynamically spawned modules (Phase 7 - Module Spawner)
# Keep the README, .csproj and .sln files but ignore other generated module files
Modules/*
!Modules/README.md
!Modules/*/
Modules/*/*.cs
Modules/*/*.md
Modules/*/*.json
!Modules/**/*.csproj
!Modules/**/*.sln
```

**Result**: `.csproj` and `.sln` files in `/Modules/` are now tracked, making it easier to:
- Share project configurations
- Open spawned modules in IDEs
- Manage module dependencies
- Build spawned modules independently

---

## Summary

| Directory | Purpose | Git Tracking | Loading Method |
|-----------|---------|--------------|----------------|
| `/RaCore/Modules/` | Built-in modules | ✅ All files tracked | Compiled into RaCore |
| `/Modules/` | Spawned modules | ✅ .csproj/.sln only | DLL loading at runtime |

**Nothing was moved or lost** - the v7.5 revamp only improved discovery and monitoring capabilities.

---

## Questions?

- For built-in module development: See `/RaCore/Modules/Extensions/README_PHASE4_5.md`
- For dynamic module spawning: See `PHASE7_QUICKSTART.md`
- For Module Spawner usage: See `/RaCore/Modules/Extensions/ModuleSpawner/README.md`
- For environment discovery: See `RAOS_V7_5_REVAMP_SUMMARY.md`

---

**Created**: 2025-01-09  
**Version**: 1.0  
**Related PRs**: #109
